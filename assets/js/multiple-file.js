var ekadhikFileDuplicateCheckArray=[];$(document).ready(function(){$(".ekadhik-input").each(function(){let thisIndex=$(this).index();let getName=$(this).attr('name');$(this).attr('data-name',getName);$(this).removeAttr('name');});$(".trigger-ekadhik").on("dragover",function(event){event.preventDefault();event.stopPropagation();$(this).parents('.ekadhik-field').addClass('dragging');});$(".trigger-ekadhik").on("dragleave",function(event){event.preventDefault();event.stopPropagation();$(this).parents('.ekadhik-field').removeClass('dragging');});if(window.File&&window.FileList&&window.FileReader){$(".trigger-ekadhik").on("drop",function(event){event.preventDefault();event.stopPropagation();let self=$(this);let targetInput=$(this).parents('.ekadhik-field').find('.ekadhik-input');let attrName=targetInput.attr('data-name');if(event.originalEvent.dataTransfer){if(event.originalEvent.dataTransfer.files.length){event.preventDefault();event.stopPropagation();upload(event.originalEvent.dataTransfer.files,attrName,targetInput);}}
self.parents('.ekadhik-field').removeClass('dragging');});$(document).on("change",".ekadhik-input",function(e){let self=$(this);let attrName=$(this).attr('data-name');upload(this.files,attrName,self);self.parents('.ekadhik-field').removeClass('hide');self.parents('.ekadhik-field-group').find('.ekadhik-group-trigger').addClass('hide');});}else{alert("Your browser doesn't support to File API")}
function upload(files,attrName,self){let inputName=attrName;let thisAfterList=self.parents('.ekadhik-field').find('.selected-file-list');let fileLimitAttr=self.attr('max');let fileLimit=null;if(typeof fileLimitAttr!=null&&typeof fileLimitAttr!='undefined')
{fileLimit=parseInt(fileLimitAttr);}
for(let i=0;i<files.length;i++){let uploadItemLength=self.parents('.ekadhik-field').find('.selected-ekadik-item').length;if(fileLimit!=null&&uploadItemLength>=fileLimit){if(typeof self.attr('data-has-error-modal')!='undefined'){let targetModal=self.attr('data-has-error-modal');$(targetModal).modal('show');}else{alert('You can upload upto'+'  '+fileLimit+'  '+'files');}
return false;}else{if(ekadhikFileDuplicateCheckArray.indexOf(attrName+files[i].name)>-1){alert(files[i].name+' already selected.');}else{let dt=new DataTransfer();let f=files[i];let time=new Date().getTime();dt.items.add(new File([f.slice(0,f.size,f.type)],f.name));self.parents('.ekadhik-field').find('.selected-file-list').append(`
                            <li class="selected-ekadik-item">
                                <div class="selected-ekadik-item-content">
                                    <input type="file" name="`+inputName+`" class="d-none attach-file-value" id="attachFile`+time+i+`">
                                    <button type='button' class="remove-ekadik-item"><span class='text'>&times</span></button>
                                </div>
                            </li>
                        `);let fileReader=new FileReader();fileReader.onload=(function(j){let file=j.target;if(isImageExtension(f.name)){$("#attachFile"+time+i).after("<img class=\"uploaded-file\" src=\""+j.target.result+"\" alt='No preview'/>").removeAttr('id');}else{$("#attachFile"+time+i).after("<span class='selected-ekadhik-icon'><i class='fa fa-file-pdf-o text-28'></i></span>").removeAttr('id');}
$("#attachFile"+time+i).removeAttr('id');});fileReader.readAsDataURL(f);var back=document.getElementById("attachFile"+time+i);back.files=dt.files;}
ekadhikFileDuplicateCheckArray.push(attrName+files[i].name);}}
self.parents('.ekadhik-field').find('.ekadhik-input').val('');}});$(document).on('click','.remove-ekadik-item',function(e){e.preventDefault();let self=$(this);let targetUrl=self.attr('data-remove-url');let parseUrl=null;if(typeof targetUrl!=null&&typeof targetUrl!='undefined')
{parseUrl=targetUrl;}
if(parseUrl==null)
{$(this).parents(".selected-ekadik-item").remove();}else{$.ajax({type:'GET',url:parseUrl,success:function(info){if(info=='no')
{let requiredCount=self.parents('.selected-file-list').attr('data-min-required');if(typeof requiredCount!=null&&typeof requiredCount!='undefined')
{self.remove();alert('Minimum '+requiredCount+' item required');}
console.log('failed to remove file');}else{self.parents('.selected-ekadik-item').remove();}}});}
if($(this).parents(".selected-ekadik-item").find('input[type="file"]').length>0)
{let matchInputAttr=$(this).parents(".selected-ekadik-item").find('input[type="file"]').attr('name');var getVal=$(this).parents(".selected-ekadik-item").find('input[type="file"]').val();var getName=matchInputAttr+getVal.replace(/C:\\fakepath\\/i,'');ekadhikFileDuplicateCheckArray=jQuery.grep(ekadhikFileDuplicateCheckArray,function(value){return value!=getName;});}});$('.ekadhik-group-trigger').on('click',function(){$(this).parents('.ekadhik-field-group').find('.ekadhik-input').trigger('click');});function isImageExtension(fileName){const allowedExtensions=[".jpg",".jpeg",".png",".gif",".bmp"];return allowedExtensions.includes(fileName.slice(fileName.lastIndexOf(".")));}